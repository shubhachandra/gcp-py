import pandas as pd
import json

INPUT_JSON = 'subnet_logs.json'
OUTPUT_CSV = 'subnet_allocation_report.csv'

# Read JSON file
with open(INPUT_JSON, 'r') as json_file:
    logs_data = json.load(json_file)

# Extract subnet utilization details
subnet_data = []
for entry in logs_data:
    json_payload = entry.get('jsonPayload', {})
    ip_utilization_info = json_payload.get('ipUtilizationInfo', [])

    for info in ip_utilization_info:
        subnet_uri = info.get('subnetUri', 'Unknown')
        allocation_ratio = info.get('allocationRatio', 'N/A')

        subnet_data.append({
            'Subnet URI': subnet_uri,
            'Allocation Ratio': allocation_ratio
        })

# Create DataFrame and export to CSV
subnet_df = pd.DataFrame(subnet_data)
subnet_df.to_csv(OUTPUT_CSV, index=False)

print(f"Subnet allocation report saved to {OUTPUT_CSV}")
